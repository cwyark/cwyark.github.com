---
title: "Understanding NDB in App Engine(1)"
description: "Understanding ndb in App Engine"
category: tutorial
tags: [python, appengine, ndb]
---

### _Entities and Models_ ###
[App engine's NDB](https://cloud.google.com/appengine/docs/python/ndb/) is a persistent storage whcih is promoted by Google Cloud Platform. It features in schemaless object datastore, automatic caching, sophisticated queries and atomic transactions.

Every data object in NDB is called `Entity`, just like a member's information( name=John, age=18, address=Taipei). If you want to use NDB in your application, you have to define a `Model` whcih is presented as a `Class` in python.This is an example of defining a `Model` (in my_model.py for example)

``` python
from google.appengine.ext import ndb

# define a ndb model
class User(ndb.Model):
    name = ndb.StringProperty()
    age = ndb.IntegerProperty()
    location = ndb.GeoPtProperty()
```

Here's a class `User` which is inherited from `ndb.Model`, and `name`, `age`, `location` are the properties of `User`. For more information about properties, you could check [here](https://cloud.google.com/appengine/docs/python/ndb/properties).

Once you finish defining a `Model`, you can play with the `Model` by using the [interactive console](http://localhost:8000/console)

``` python
>>> from my_model import User
>>> a = User(name='John', age=8)
>>> a.put()
```

The `put` method is to put the entity into the database. Now you can find a new data(whih is called an `entity`) in your [Datastore Viewer](http://localhost:8000/datastore)

As you can see in your datastore viewer, there are `Key`, `id` or `Key Name` in your created entity, these fields are ndb's special features, which can be automatically generated by the datastore, or you can assign these value on your own.

### _Entity and Key Object_ ###

#### Create an entity ####
In previous talk, you can create an `entity` by using ...

``` python
>>> a = User(name='John', are=8)
>>> a.put()
```

Or you can use an alternative way if you want to dynamically assign the properties's value.

``` python
>>> a = User()
>>> a.name = 'John'
>>> a.age = 8
>>> a.put()
```

#### Key is an unique object ####

In AppEngine, `Key` is like an unique `object` which can identify the entity. One entity only has one Key. For example, you can try to duplcate an entity: User(name='John', age=8) in your datastore.

``` python
>>> a = User(name='John', age=8)
>>> b = User(name='John', age=8)
>>> a.put()
>>> b.put()
```

Both entities `a` and `b` have the same properties name='John' and age=8, but they have different Keys in your datastore viewer. 

As a result, they are still the different entities.

But what can a `Key` do ? You can image the Key object is like a real key that can help you to retrive your entity.

``` python
>>> a = User(name='John', age=8)
>>> a_key = a.put()
>>> a_urlsafe = a_key.urlsafe()
>>> print a_urlsafe
ag9kZXZ-emV1cy1zeXN0ZW1yEQsSBFVzZXIYgICAgICAwAkM
```
    
Everytime doing the `put` method, it will return the `Key` object. You can retrive the Key's unique string by using the `urlsafe` method. Once you get the urlsafe string `a_urlsafe`, you can reversly get the entity' Key  by using `b_key = ndb.Key(urlsafe=a_urlsafe)`.

Now retrive the entity from the Key object.

``` python
>>> b_key = ndb.Key(urlsafe=a_urlsafe)
>>> b = b_key.get()
User(key=Key('User', 5348024557502464), age=8, location=None, name=u'John')
```

#### Delete an entity ####

If you want to delete this entity by using the `Key` object

``` python
>>> b_key.delete()
```
    
Or by using the entity

``` python
>>> b.key.delete()
```


